---
title: "Airline Customer Satisfaction - Group 17"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    toc_float: true
  pdf_document: default
date: "2025-03-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Project Background <a name="1"></a>

Lorem Ipsum

## Abstract <a name="1.1"></a>

**Framework for abstract:**

-   Introduction to airline industry

-   What the data is about

    -   customer satisfaction scores from 120,000+ passengers

    -   Nothing about the carrier

    -   Nothing about the price

-   What the research seeks to find

    -   Predict whether future customer would be satisfied given the details of service

    -   Determine the aspects of service that are important towards customer satisfaction

-   Methods of analysis

-   What the data tells us (findings)

**Draft of abstract:**

After industry-wide setbacks from the COVID-19 pandemic, the airline industry is experiencing a strong recovery in profitability. According to the International Air Transport Association (IATA), airlines worldwide have seen improved projections since 2024. The market is projected to showcase an annual growth rate (CAGR 2025-2029) of 4.36%, resulting in a projected market volume of US\$771.26bn by 2029, worldwide (Statista, 2024). However, low-cost carriers (LCCs) are shifting the traditional perceptions of value and service among travelers by offering lower fares with fewer amenities. As traditional full-service airlines compete in this market environment, understanding the main drivers of customer satisfaction becomes critical to maintain competitiveness.

In this research, we analyze data from over 120,000+ airline passengers, including information on passenger demographics, flight characteristics (delays and distance), as well as service evaluations. Since this data lacks information on the specific airlines and ticket pricing, we will focus on analyzing the service-related factors that universally impact passenger satisfaction. This research aims to:

1.  **Predict whether future customer would be satisfied given the details of service**
2.  **Determine the aspects of service that are important towards customer satisfaction**

In our analysis, we initially explore the dataset to understand the variables and their distributions, as well as detect missing values. Data preparation procedures such as cleaning, normalization, and transformation are conducted before analysis. We utilize Principal Component Analysis (PCA) to reduce dimensionality as well as to determine key variables. Clustering is then implemented to gain deeper insights on passenger groups and patterns of service satisfaction.**\<- placeholder aja, bisa diubah**

In summary.... **(hasil temuan)**

## Business Problem <a name="1.2"></a>

In this project, Group 17 serves as business consultants, with a focus on improving customer experience in the industry. Our responsibilities are from analyzing customer satisfaction statistics, developing measures to improve the airline's overall performance. Therefore, the business problem that we solve is "how can airlines improve its strategy of services and activities to increase customer satisfaction, especially between segments and main service areas, to achieve stronger competitive advantages?".

**The reason why we chose airline industry as our focus :**

-   Low-cost carriers (LCCs) are shifting the traditional perceptions of value and service among travelers by offering lower fares with fewer amenities.

-   Intense rivalry among airlines could be easily justified by customer satisfaction. Thus, higher customer satisfaction leads to increased client retention and overall business performance.

-   Concentrating on major market segments may provide a more general view of the aspects contributing to consumer satisfaction.

**Why focus on customer satisfaction?**

Enhance customer loyalty: improving on these key segments and service areas will enhance customer satisfaction that potentially increases customer loyalty rate.

Competitive Advantage: by addressing the service issue, the airline can stand out from the competitors.

## Setting Up the R Workplace <a name="1.3"></a>

Lorem IpsumBesides the Basic R Functions, this project uses multiple packages to enhance the R functionalities and improve the data analytics and visualization quality. This section explains all the packages and functions beyond the Basic R functionalities that we are using in this project in each step of the business analytics process from data cleaning to modeling.

* Data Cleaning and Preparation

**dplyr** : used to filter rows, select columns, sort data, create new columns, and summarize data.

**tidyr** : imported to be used to clean and tidy the data, such as reshaping the data from wide to long format.

* Data Exploration

**skimr** : designed to provide summary of statistical measures for each variables in data frames.

**DataExplorer** : used to display comprehensive and convenient interface for data exploration and data visualization.

* Data Transformation

* Data Visualization

**ggplot2** : a package that is useful to visualize data in a more complex and customizable way compared to the basic R plotting functions.

**corrplot** : used to visualize correlation matrix between two variables in a more visually appealing and informative way.

* Data Modeling

* Data Analysis

Below we will find the commands to install the required libraries so that the code can run properly.The libraries only need to be imported only once, later we only need to call the necessary libraries when needed on the specific sections.

```{r}
# Importing Library

library(dplyr)
library(ggplot2)
library(skimr)
library(DataExplorer)
library(corrplot)
library(tidyr)
```

## Dataset <a name="1.4"></a>

In this assignment, we use data set of [Airline Passenger Satisfaction Dataset](https://www.kaggle.com/datasets/mysarahmadbhat/airline-passenger-satisfaction) through Kaggle.The data consist of 24 variables from 129,880 passengers. Data cleaning and preparation are required to ensure the data is ready for analysis.

Firstly import all the data, csv file to be used in the data analysis process. The before using the data, it is important to undertand all data type included in the data set.Subsequently, understanding statistic perofile in the data set could help to prepare the data before using it.

```{r}
# Read Data
# please note that the csv needs to be put into the same folders as this file for ensuring everything works properly
# the dataset should be downloaded from the Kaggle, or unzip from our submission in BrightSpace.
data <- read.csv("airline_passenger_satisfaction.csv")

#Understanding the data types
str(data)
```

```{r}
# Summary of Data statistics
summary(data)
```

### Data Dictionary

Based on Kaggle, here is the definition of each column in the dataset. This is useful for later stage to understand the data characteristics and how to use it.

```{=html}
<style>
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th {
    background-color: #87CEEB; /* Sky blue header */
    color: white;
    text-align: left;
    padding: 8px;
  }
  td {
    padding: 8px;
    text-align: left;
  }
  th, td {
    border: 1px solid #ddd;
  }
  th:first-child, td:first-child {
    width: 200px; /* Adjust field name column width */
  }
  th:last-child, td:last-child {
    width: 600px; /* Adjust description column width */
  }
</style>
```

| **Field Name** | **Description** |
|------------------------------------|------------------------------------|
| **ID** | Unique passenger identifier |
| **Gender** | Gender of the passenger (Female/Male) |
| **Age** | Age of the passenger |
| **Customer Type** | Type of airline customer (First-time/Returning) |
| **Type of Travel** | Purpose of the flight (Business/Personal) |
| **Class** | Travel class in the airplane for the passenger seat |
| **Flight Distance** | Flight distance in miles |
| **Departure Delay** | Flight departure delay in minutes |
| **Arrival Delay** | Flight arrival delay in minutes |
| **Departure and Arrival Time Convenience** | Satisfaction level with the convenience of the flight departure and arrival times from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Ease of Online Booking** | Satisfaction level with the online booking experience from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Check-in Service** | Satisfaction level with the check-in service from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Online Boarding** | Satisfaction level with the online boarding experience from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Gate Location** | Satisfaction level with the gate location in the airport from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **On-board Service** | Satisfaction level with the on-boarding service in the airport from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Seat Comfort** | Satisfaction level with the comfort of the airplane seat from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Leg Room Service** | Satisfaction level with the leg room of the airplane seat from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Cleanliness** | Satisfaction level with the cleanliness of the airplane from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Food and Drink** | Satisfaction level with the food and drinks on the airplane from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **In-flight Service** | Satisfaction level with the in-flight service from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **In-flight Wifi Service** | Satisfaction level with the in-flight Wifi service from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **In-flight Entertainment** | Satisfaction level with the in-flight entertainment from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Baggage Handling** | Satisfaction level with the baggage handling from the airline from 1 (lowest) to 5 (highest) - 0 means "not applicable" |
| **Satisfaction** | Overall satisfaction level with the airline (Satisfied/Neutral or unsatisfied) |

## Workflow: Machine-Learning Task Translation <a name="1.5"></a>

The business analysis focuses on what key parameters from passengers' perspective that define their satisfactory level towards airline services. The analysis will be conducted by perfroming predictive modelling (regression analysis) as well as classification. Run code belows to see the workflow of the analysis.

```{r}
file_path <- "Workflow_Group17.png"
knitr::include_graphics(file_path)
```

## Reflection and Limitation <a name="1.6"></a>

In this research, we aim to predict **whether future customer would be satisfied given the details of service** by determining **the aspects of service that are important towards customer satisfaction.** From the dataset, we hypothesize that service characteristics such as arrival and departure delays, on-board service, and comfort play a significant role towards customer satisfaction.

Given that the dataset does not provide information on the specific airline or ticket pricing, we will focus to analyzing the service-related factors that universally impact passenger satisfaction. Understanding and preparing the the dataset will be crucial, as it may contain missing values or quality issues. Hence, we will dedicate the next section on data exploration and preparation. In doing so, we will first visualize the variables to get an understanding of the distributions.

# Data Exploration and Preparation <a name="2"></a>

In this chapter, we will use visual and descriptive data exploration methods to gain a deeper understanding of the distributions and the characteristics of variables in our dataset. We will begin by cleaning the data from any null variables, as well has handle outliers in the data. Later in this chapter, we will continue to explore each variable and interpret features. Finally, we will conduct initial plotting of the data to show how the features are correlated to each other.

## Data Cleaning and Preparation <a name="2.1"></a>

We will start the exploration phase by checking for missing data using the `is.na()` function.

```{r check_missing_data}
any(is.na(data))
colMeans(is.na(data))
```

We find that null data only exists for 0.3% and only in the **Arrival Delay** column, therefore this would not significantly affecting the whole dataset. We'll fill the Arrival Delay null with the mean and median of Arrival Delay which is 0.

```{r eliminating_null_values}
data$Departure.Delay = as.numeric(data$Departure.Delay)
data$Arrival.Delay[is.na(data$Arrival.Delay)] <-0
any(is.na(data))
```

We succesfully replace the null values in the dataset. Let's check for numerical outliers using the `summary()` function, we will look for major differences between the median and the mean.

```{r summary_of_data}
# Extract summary statistics for numerical columns
numerical_summary <- data.frame(t(sapply(data[sapply(data, is.numeric)], summary)))

# Add a column to calculate the difference between mean and median
numerical_summary$Mean_Median_Difference <- abs(numerical_summary$Mean - numerical_summary$Median)

# Tabulate the output
knitr::kable(numerical_summary, caption = "Summary of Numerical Columns with Mean-Median Differences")

remove(numerical_summary)
```

We notice that there are large outliers in the Flight Distance, as well as in Arrival and Departure Delay. Let's see in the boxplot format :

**Flight Distance**

```{r}
ggplot(data, aes(x=Flight.Distance)) +
geom_boxplot(fill = 2,alpha = 0.5,color = 1,outlier.colour = 2) +
theme_bw()
```

**Departure Delay**

```{r}
ggplot(data, aes(x=Departure.Delay)) +
geom_boxplot(fill = 2,alpha = 0.5,color = 1,outlier.colour = 2) +
theme_bw()
```

**Arrival Delay**

```{r}
ggplot(data, aes(x=Arrival.Delay)) +
geom_boxplot(fill = 2,alpha = 0.5,color = 1,outlier.colour = 2) +
theme_bw()
```

From the boxplots above, we can see that Flight Distance is slightly skewed while Arrival Delay and Departure Delay is heavily skewed. We will use median imputation, which is appropriate when the distribution of the data is skewed.

```{r median_imputation}
# Imputation of flight.distance variable
data$Flight.Distance[which(
  data$Flight.Distance > (quantile(data$Flight.Distance, 0.75, na.rm = TRUE) + 1.5 * IQR(data$Flight.Distance, na.rm = TRUE))
)] <- median(data$Flight.Distance, na.rm = TRUE)

# Imputation of arrival.delay variable
data$Arrival.Delay[which(
  data$Arrival.Delay > (quantile(data$Arrival.Delay, 0.75, na.rm = TRUE) + 1.5 * IQR(data$Arrival.Delay, na.rm = TRUE))
)] <- median(data$Arrival.Delay, na.rm = TRUE)

# Imputation of departure.delay variable
data$Departure.Delay[which(
  data$Departure.Delay > (quantile(data$Departure.Delay, 0.75, na.rm = TRUE) + 1.5 * IQR(data$Departure.Delay, na.rm = TRUE))
)] <- median(data$Departure.Delay, na.rm = TRUE)
```

Now let's check the distribution of the data after the imputation.

```{r histogram_of_imputed_variables}
plot_histogram(data[ , c('Flight.Distance','Arrival.Delay','Departure.Delay')], ncol=2,ggtheme = theme_minimal())
```

Below, we will also take a look again at the boxplots for Departure Delay and Arrival Delay. Note that before the imputation, the plots were skewed to the point that the boxes were almost no longer visible.

```{r}
ggplot(data, aes(x=Departure.Delay)) +
geom_boxplot(fill = 2,alpha = 0.5,color = 1,outlier.colour = 2) +
theme_bw()
```

```{r}
ggplot(data, aes(x=Arrival.Delay)) +
geom_boxplot(fill = 2,alpha = 0.5,color = 1,outlier.colour = 2) +
theme_bw()
```

We can see that we have significantly normalized the skewness of the data. Thus, we have successfully eliminated all missing values and normalized all outliers in the data. Next, we will continue further into the data exploration phase.

## Data Exploration <a name="2.2"></a>

In this subchapter, we will begin by conducting descriptive univariate data analysis which is followed by association between numerical and categorical variables.

### Univariate Data Analysis

Now we visualize the distribution in each categorical column

```{r visualizing_categorical_variables}

# Bar chart will be used for categorical data
plot_bar(data, ncol=2, order_bar=TRUE, ggtheme = theme_minimal())
```

We can see that the gender distribution is equal. Furthermore, the majority type of travel is business which is also reflected in the customer type, where the majority is returning customers rather than first-time. Hence, increasing satisfaction of loyal customers will bring significant impact to the overall of airline customer satisfaction rate. Next, we will visualize the distribution in each numerical column. The ID column is left out as it is just a list of numbers.

```{r visualizing_numerical_variables}

# Numerical variables are visualized using histogram
plot_histogram(data[ , !names(data) %in% "ID"], ncol=2, ggtheme = theme_minimal())
```

From the visualizations above, it is not immediately clear which variables may be strongly influencing each other. Hence, we will continue the exploration by analyzing the associations between numerical variables.

### Association Between Two Numerical Variable

```{r corrplot, fig.width=14, fig.height=12}
numeric_data <- data[sapply(data, is.numeric)]
numeric_data <- na.omit(numeric_data)

# Compute correlation matrix
cor_matrix <- cor(numeric_data)

# Print the correlation matrix
print(cor_matrix)

# Visualize the correlation matrix
options(repr.plot.width=14, repr.plot.height=12)
corrplot(cor_matrix,
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.cex = 0.8,
         number.cex = 0.7,
         addCoef.col = "black",
         diag = FALSE)
```

Lorem Ipsum

```{r}
# Discover strong correlation
cor_matrix_flat <- as.data.frame(as.table(cor_matrix))
filtered <- subset(cor_matrix_flat, abs(Freq) > 0.5 & Var1 != Var2)
filtered <- filtered[!duplicated(t(apply(filtered[, 1:2], 1, sort))), ]

print(filtered)
```

From the graph, we can see that there are some variables that have a strong correlation with each other, which is Seat Comfort, Leg Room Service, Cleanliness, Food & Drink, and In-flight Service exhibit strong positive correlations with each other. This suggests that customers who rate one aspect of the service highly tend to rate others positively as well. Furthermore, A high correlation between Departure Delay and Arrival Delay indicates that flights that depart late are also likely to arrive late. Other numerical factors such as Flight Distance may have weaker correlations with customer satisfaction, indicating that distance alone is not a major factor in satisfaction levels.

**In-flight Service vs On-board Service (in %)**

```{r}
count_data <- as.data.frame(table(data$In.flight.Service, data$On.board.Service))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "In-flight Service vs On-board Service (in %)",
       x = "In-flight Service Rating",
       y = "On-board Service Rating",
       fill = "Percentage") +
  theme_minimal()
```

The heatmap above shows a strong positive correlation between In-flight Service and On-board Service. This suggests that passengers who rate one aspect of the service highly also tend to rate the other positively. Darker shades indicate higher percentages, with the highest concentration (20.2%) at ( In-flight Service= 4, On-board Service = 4), suggesting a tendency for passengers to rate both aspects positively together.

**In-flight Service vs Food and Drink (in %)**

```{r}
count_data <- as.data.frame(table(data$In.flight.Entertainment, data$Food.and.Drink))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "In-flight Entertainment vs Food and Drink (in %)",
       x = "In-flight Entertainment Rating",
       y = "Food and Drink Rating",
       fill = "Percentage") +
  theme_minimal()
```

From the heatmap above, we can see that there is a strong positive correlation between In-flight Entertainment and Food and Drink. he most common rating combination is (4,4), accounting for 16.9% of responses, followed by (5,5) with 14.8%, indicating This suggests that passengers who rate the in-flight entertainment highly also tend to rate the food and drink positively.

**In-flight Entertainment vs Cleanliness (in %)**

```{r}
count_data <- as.data.frame(table(data$In.flight.Entertainment, data$Cleanliness))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "In-flight Entertainment vs Cleanliness (in %)",
       x = "In-flight Entertainment Rating",
       y = "Cleanliness Rating",
       fill = "Percentage") +
  theme_minimal()
```

We can see from the heatmap above that there is a positive correlation between In-flight Entertainment and Cleanliness with frequent rating pair is (4,4) at 17.9%, followed by (5,5) at 15.4%,. This suggests that passengers who rate the in-flight entertainment highly also tend to rate the cleanliness positively.

**In-flight Entertainment vs Seat Comfort (in %)**

```{r}
count_data <- as.data.frame(table(data$In.flight.Entertainment, data$Seat.Comfort))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "In-flight Entertainment vs Seat Comfort (in %)",
       x = "In-flight Entertainment Rating",
       y = "Seat Comfort Rating",
       fill = "Percentage") +
  theme_minimal()
```

This heatmap depicts a positive correlation between In-flight Entertainment and Seat Comfort. The most common rating combination is (4,4) at 17.9%, followed by (5,5) at 15.1%. This suggests that passengers who rate the in-flight entertainment highly also tend to rate the seat comfort positively.

```{r}
count_data <- as.data.frame(table(data$Food.and.Drink, data$Cleanliness))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "Food and Drink vs Cleanliness (in %)",
       x = "Food and Drink Rating",
       y = "Cleanliness Rating",
       fill = "Percentage") +
  theme_minimal()
```

**Food and Drink vs Seat Comfront (in %)**

```{r}
count_data <- as.data.frame(table(data$Food.and.Drink, data$Seat.Comfort))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "Food and Drink vs Seat Comfort (in %)",
       x = "Food and Drink Rating",
       y = "Seat Comfort Rating",
       fill = "Percentage") +
  theme_minimal()
```

This heatmap illustrates a positive correlation between Food and Drink and Seat Comfort. The most common rating combination is (4,4) at 16%, followed by (5,5) at 13.8%. This suggests that passengers who rate the food and drink highly also tend to rate the seat comfort positively.

**Cleanliness vs Seat Comfort (in %)**

```{r}
count_data <- as.data.frame(table(data$Cleanliness, data$Seat.Comfort))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "Cleanliness vs Seat Comfort (in %)",
       x = "Cleanliness Rating",
       y = "Seat Comfort Rating",
       fill = "Percentage") +
  theme_minimal()
```

This heatmap shows a positive correlation between Cleanliness and Seat Comfort. The most common rating combination is (4,4) at 17.9%, followed by (5,5) at 15.1%. This suggests that passengers who rate the cleanliness highly also tend to rate the seat comfort positively.

**In-Flight Wifi Service vs Ease of Online Booking (in %)**

```{r}
count_data <- as.data.frame(table(data$In.flight.Wifi.Service, data$Ease.of.Online.Booking))
count_data$Percent <- round(100 * count_data$Freq / sum(count_data$Freq), 1)

# Plot heatmap
ggplot(count_data, aes(x = Var1, y = Var2, fill = Percent)) +
  geom_tile(color = "white") +
  geom_text(aes(label = paste0(Percent, "%")), color = "black", size = 3) +
  scale_fill_gradient(low = "lightyellow", high = "darkred") +
  labs(title = "In-Flight Wifi Service vs Ease of Online Booking (in %)",
       x = "In-Flight Wifi Service Rating",
       y = "Ease of Online Booking Rating",
       fill = "Percentage") +
  theme_minimal()
```

This heatmap shows a positive correlation between In-flight Wifi Service and Ease of Online Booking. The most common rating pair is (2,3) at 18.1%, closely followed by (1,2) at 18% and (1,1) at 12.5%, suggesting that many passengers who rated WiFi service poorly also found online booking less convenient. Interestingly, higher ratings for online booking (4-5) are associated with mixed ratings for WiFi, with 8.1% rating both as (5,5). This pattern implies that while passengers may find booking easy, WiFi service still receives moderate to low ratings.

**Flight Distance vs Departure Delay**

```{r}
ggplot(data, aes(x = Flight.Distance, y = Departure.Delay)) +
  geom_point(alpha = 0.2, color = "steelblue", size = 1.5) +
  labs(title = "Flight Distance vs Departure Delay",
       x = "Flight Distance",
       y = "Departure Delay") +
  geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 1) +
  theme_minimal()
```

From the scatter plot above, we can see that there is a slight positive correlation between Flight Distance and Departure Delay. The red line likely represents a trend or regression line, showing the general pattern in the data. The data appears to be highly discrete, with many flights experiencing common delay times (e.g., 0, 5, 10, 15 minutes). The trend line suggests that departure delays slightly increase as flight distance increases, but the relationship is not strong. There is significant variability in departure delays across all flight distances, meaning other factors likely influence delays beyond just distance..

**Flight Distance vs Arrival Delay**

```{r}
ggplot(data, aes(x = Flight.Distance, y = Arrival.Delay)) +
  geom_point(alpha = 0.2, color = "steelblue", size = 1.5) +
  labs(title = "Flight Distance vs Arrival Delay",
       x = "Flight Distance",
       y = "Arrival Delay") +
  geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 1) +
  theme_minimal()
```

The scatter plot above shows a slight positive correlation between Flight Distance and Arrival Delay.he red line, likely a trend or regression line, suggests that the average arrival delay remains relatively low regardless of flight distance. While there is some variability, the data does not indicate a strong correlation between flight distance and arrival delay.

### Association Between Numerical and Categorical Variable

Lorem ipsum

```{r}
data_subset <- data %>%
  select(Satisfaction, Age, Flight.Distance, Departure.Delay,
         Arrival.Delay)

# Convert to long format for faceting
data_long <- pivot_longer(data_subset, -Satisfaction, names_to = "Variable", values_to = "Value")

# Plot boxplots with facets
ggplot(data_long, aes(x = Satisfaction, y = Value, fill = Satisfaction)) +
  geom_boxplot() +
  facet_wrap(~ Variable, scales = "free_y") +
  theme_minimal() +
  labs(title = "Boxplots of Numeric Variables by Satisfaction",
       x = NULL, y = NULL) +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "none"
  )
```

The boxplots compare numeric variables (Age, Arrival Delay, Departure Delay, and Flight Distance) by satisfaction levels (Neutral or Dissatisfied vs. Satisfied). Satisfied customers tend to have higher ages and longer flight distances, as indicated by the higher medians and broader distributions for these groups. Conversely, Arrival and Departure Delays show minimal differences between satisfaction groups, with both distributions being highly skewed and overlapping significantly. This suggests that delays may not strongly influence satisfaction compared to age and flight distance.

```{r}
data_subset <- data %>%
  select(Satisfaction, Ease.of.Online.Booking, Check.in.Service, Online.Boarding,
         Gate.Location, On.board.Service, Leg.Room.Service, Flight.Distance)

# Convert to long format
data_long <- pivot_longer(data_subset, -Satisfaction, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Satisfaction)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Satisfaction",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

```{r}
data_subset <- data %>%
  select(Satisfaction, Seat.Comfort, In.flight.Service, Baggage.Handling,
         In.flight.Entertainment, In.flight.Wifi.Service, Food.and.Drink, Cleanliness)

# Convert to long format
data_long <- pivot_longer(data_subset, -Satisfaction, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Satisfaction)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Satisfaction",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

The histograms display the distribution of numeric variables grouped by customer satisfaction levels which is Neutral or Dissatisfied (pink) and Satisfied (blue) across various aspects of airline services. In general, higher ratings (closer to 5) for services such as Check-in Service, Ease of Online Booking, Leg Room Service, Online Boarding, and Gate Location correspond more strongly with satisfied customers. Conversely, dissatisfaction is more prevalent at lower ratings (closer to 0 or 1). For Flight Distance, satisfied customers are slightly more common in longer flights. Similarly, variables like Baggage Handling, Cleanliness, Food and Drink, In-flight Entertainment, In-flight Service, In-flight Wi-Fi Service, and Seat Comfort show a similar trend where higher ratings indicate greater satisfaction, while lower ratings are associated with dissatisfaction. These distributions suggest that satisfaction is closely tied to the quality of services provided across these dimensions.

```{r}
data_subset <- data %>%
  select(Class, Age, Flight.Distance, Departure.Delay,
         Arrival.Delay)

# Convert to long format for faceting
data_long <- pivot_longer(data_subset, -Class, names_to = "Variable", values_to = "Value")

# Plot boxplots with facets
ggplot(data_long, aes(x = Class, y = Value, fill = Class)) +
  geom_boxplot() +
  facet_wrap(~ Variable, scales = "free_y") +
  theme_minimal() +
  labs(title = "Boxplots of Numeric Variables by Class",
       x = NULL, y = NULL) +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "none"
  )
```

The boxplots compare Age, Arrival Delay, Departure Delay, and Flight Distance across Business, Economy, and Economy Plus classes. Business class passengers are generally older, with a higher median age compared to Economy and Economy Plus, which show similar distributions. Arrival and departure delays have medians near zero across all classes, indicating most flights are on time, but all classes exhibit outliers representing extreme delays. Flight distance is notably higher for Business class, with a greater median and variability compared to the shorter and more consistent distances in Economy and Economy Plus. This suggests Business class is preferred for longer flights and by older passengers, while delays are consistent across all classes.

```{r}
data_subset <- data %>%
  select(Class, Ease.of.Online.Booking, Check.in.Service, Online.Boarding,
         Gate.Location, On.board.Service, Leg.Room.Service, Flight.Distance)

# Convert to long format
data_long <- pivot_longer(data_subset, -Class, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Class)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Class",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

```{r}
data_subset <- data %>%
  select(Class, Seat.Comfort, In.flight.Service, Baggage.Handling,
         In.flight.Entertainment, In.flight.Wifi.Service, Food.and.Drink, Cleanliness)

# Convert to long format
data_long <- pivot_longer(data_subset, -Class, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Class)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Class",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

The histograms compare numeric variables across flight classes (Business, Economy, and Economy Plus) to assess customer satisfaction. Business class consistently receives higher ratings across most variables, such as Check-in Service, Leg Room Service, Online Boarding, On-board Service, Cleanliness, Food and Drink, In-flight Entertainment, In-flight Wifi Service, and Seat Comfort, highlighting its superior service quality and comfort. Economy Plus generally performs better than Economy but falls short of Business class ratings. Economy class exhibits greater variability in ratings and is often skewed toward lower scores for services like legroom, onboard service, food quality, and seat comfort. Flight Distance shows Business class dominating longer flights, while Economy handles shorter distances. Variables like Gate Location and Ease of Online Booking show relatively even distributions across classes. Overall, the data emphasizes the premium experience associated with Business class compared to Economy and Economy Plus.

```{r}
data_subset <- data %>%
  select(Type.of.Travel, Age, Flight.Distance, Departure.Delay,
         Arrival.Delay)

# Convert to long format for faceting
data_long <- pivot_longer(data_subset, -Type.of.Travel, names_to = "Variable", values_to = "Value")

# Plot boxplots with facets
ggplot(data_long, aes(x = Type.of.Travel, y = Value, fill = Type.of.Travel)) +
  geom_boxplot() +
  facet_wrap(~ Variable, scales = "free_y") +
  theme_minimal() +
  labs(title = "Boxplots of Numeric Variables by Type of Travel",
       x = NULL, y = NULL) +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "none"
  )
```

The boxplots illustrate the distribution of four numeric variables,Age, Arrival Delay, Departure Delay, and Flight Distance grouped by the type of travel (Business or Personal). Business travelers tend to be slightly older on average than personal travelers, with a narrower age range. Both groups experience similar patterns in arrival and departure delays, though delays for personal travel show more variability and outliers. Flight distance varies significantly between the two groups, with business travelers generally covering shorter distances compared to personal travelers, which exhibit a wider range and more outliers.

```{r}
data_subset <- data %>%
  select(Type.of.Travel, Ease.of.Online.Booking, Check.in.Service, Online.Boarding,
         Gate.Location, On.board.Service, Leg.Room.Service, Flight.Distance)

# Convert to long format
data_long <- pivot_longer(data_subset, -Type.of.Travel, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Type.of.Travel)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Type of Travel",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

```{r}
data_subset <- data %>%
  select(Type.of.Travel, Seat.Comfort, In.flight.Service, Baggage.Handling,
         In.flight.Entertainment, In.flight.Wifi.Service, Food.and.Drink, Cleanliness)

# Convert to long format
data_long <- pivot_longer(data_subset, -Type.of.Travel, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Type.of.Travel)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Type of Travel",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

The histograms illustrate, Across most variables, Business travelers dominate the counts, particularly for higher ratings (4 and 5), indicating greater satisfaction. In contrast, Personal travelers are fewer and show a more even distribution across lower and higher ratings. Flight Distance shows a distinct peak for shorter distances, with Business travelers being more frequent. Overall, Business travelers tend to rate services higher than Personal travelers.

```{r}
data_subset <- data %>%
  select(Gender, Age, Flight.Distance, Departure.Delay,
         Arrival.Delay)

# Convert to long format for faceting
data_long <- pivot_longer(data_subset, -Gender, names_to = "Variable", values_to = "Value")

# Plot boxplots with facets
ggplot(data_long, aes(x = Gender, y = Value, fill = Gender)) +
  geom_boxplot() +
  facet_wrap(~ Variable, scales = "free_y") +
  theme_minimal() +
  labs(title = "Boxplots of Numeric Variables by Gender",
       x = NULL, y = NULL) +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "none"
  )
```

The boxplots compare four numeric variables of Age, Arrival Delay, Departure Delay, and Flight Distance by gender (Female and Male). For Age, males have a slightly higher median than females, with similar interquartile ranges (IQRs) and no visible outliers. Arrival Delay and Departure Delay show comparable distributions for both genders, with medians near zero, narrow IQRs, and numerous outliers indicating extreme delays. Flight Distance reveals a slightly higher median and wider variability among males compared to females, with some outliers in both groups representing unusually long flights. Overall, the distributions of delays are similar across genders, while Flight Distance shows more variability for males.

```{r}
data_subset <- data %>%
  select(Gender, Ease.of.Online.Booking, Check.in.Service, Online.Boarding,
         Gate.Location, On.board.Service, Leg.Room.Service, Flight.Distance)

# Convert to long format
data_long <- pivot_longer(data_subset, -Gender, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Gender)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Gender",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

```{r}
data_subset <- data %>%
  select(Gender, Seat.Comfort, In.flight.Service, Baggage.Handling,
         In.flight.Entertainment, In.flight.Wifi.Service, Food.and.Drink, Cleanliness)

# Convert to long format
data_long <- pivot_longer(data_subset, -Gender, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Gender)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Gender",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

The histograms illustrate the distribution of ratings for various airline service attributes (Baggage Handling, Cleanliness, Food and Drink, In-flight Entertainment, In-flight Service, In-flight WiFi Service, and Seat Comfort) segmented by gender (Female and Male). Across most categories, ratings of 4 and 5 are predominant, indicating overall positive feedback. Both genders exhibit similar patterns in their evaluations, with slight variations in proportions. For example, females appear to rate slightly higher in categories like In-flight Entertainment and Cleanliness compared to males. Conversely, males seem to have a marginally higher count in lower ratings (1–3) for some categories like Seat Comfort and In-flight WiFi Service. This suggests gender-based nuances in satisfaction levels but overall consistency in favoring higher ratings across services

```{r}
data_subset <- data %>%
  select(Customer.Type, Age, Flight.Distance, Departure.Delay,
         Arrival.Delay)

# Convert to long format for faceting
data_long <- pivot_longer(data_subset, -Customer.Type, names_to = "Variable", values_to = "Value")

# Plot boxplots with facets
ggplot(data_long, aes(x = Customer.Type, y = Value, fill = Customer.Type)) +
  geom_boxplot() +
  facet_wrap(~ Variable, scales = "free_y") +
  theme_minimal() +
  labs(title = "Boxplots of Numeric Variables by Customer Type",
       x = NULL, y = NULL) +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "none"
  )
```

The boxplots compare numeric variables (Age, Arrival Delay, Departure Delay, and Flight Distance) between two customer types: First-time and Returning. For Age, returning customers tend to be older, with a higher median and wider range compared to first-time customers. Arrival Delay and Departure Delay show similar distributions for both groups, with most values concentrated around zero and a significant number of outliers indicating occasional long delays. For Flight Distance, returning customers generally travel longer distances, as evidenced by a higher median and greater variability compared to first-time customers. Overall, returning customers exhibit distinct patterns in age and flight distance, while delays are similarly distributed across both groups.

```{r}
data_subset <- data %>%
  select(Customer.Type, Ease.of.Online.Booking, Check.in.Service, Online.Boarding,
         Gate.Location, On.board.Service, Leg.Room.Service, Flight.Distance)

# Convert to long format
data_long <- pivot_longer(data_subset, -Customer.Type, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Customer.Type)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Customer Type",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

```{r}
data_subset <- data %>%
  select(Customer.Type, Seat.Comfort, In.flight.Service, Baggage.Handling,
         In.flight.Entertainment, In.flight.Wifi.Service, Food.and.Drink, Cleanliness)

# Convert to long format
data_long <- pivot_longer(data_subset, -Customer.Type, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Customer.Type)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of Numeric Variables by Customer Type",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

The two sets of histograms display the distribution of numeric variables related to customer satisfaction across two customer types: "First-time" and "Returning." Each variable, such as "Check.in.Service," "Flight.Distance," "Leg.Room.Service," and others, is rated on a scale (likely 0–5), and the counts for each rating are shown separately for the two customer types, with "Returning" customers represented in teal and "First-time" customers in pink. Across most variables, returning customers consistently dominate the counts, suggesting they are more frequent or engaged with the airline. Ratings of 4 and 5 tend to have higher counts for both groups in service-related categories like "Ease.of.Online.Booking," "Leg.Room.Service," and "Seat.Comfort," indicating general satisfaction. However, some variables like "Gate.Location" and "In.flight.Wifi.Service" show substantial variability, suggesting room for improvement in these areas. Overall, the histograms provide insights into customer preferences and satisfaction trends based on experience type.

### Association Between Two Categorical Variable

Recalling the Univariate Data Analysis, we will use five categories or variables that we deemed important as the base for further analysis, specifically to see the association between two categorical variables. These variables are distribution of gender, customer type, type of travel, class, and the disparity of numbers between satisfacted and unsatisfied passengers.

```{r}
plot_bar(data,ncol=2)
```
We will use the plot_bar function to visualize the association between these variables. For each of the following five sections, we take out one of the category and plot the association between each of the remaining four categories with the missing category. We start with creating the association between customer's satisfaction with the other four variables.

```{r}
plot_bar(data,by='Satisfaction',ncol=2)
```

From the univariate data distribution, we already know the numbers of satisfied and unsatisfied passengers is not equal with noticeable difference, with the majority of passengers being unsatisfied. So it is not surprising that regardless of the association between passengers' satisfaction with other categories, most graphs are showing the skew towards the neutral or dissatisfied category.

However, it could be noticed that the distribution of satisfaction level across both genders are relatively equal, while the first time flyers are more likely to be unsatisfied rather than the frequent travelers. Business travelers also tend to be more satisfied than the economy class passengers. This is also the case for the business class passengers. We will see in the other section that passengers with business intention are more likely to fly on business class, so the correlation is consistent in the satisfaction level as well. *This is understandable, since airlines with business class are more likely to have extra services and better quality of basic services, which means that it is more likely to satisfy the passengers. (belum tau info ini mending dimasukin di sini atau bagian data analysis).* Hence, the focus on improving the satisfaction rate of passengers should be on the economy class passengers with leisure intention, especially those who are first time flyers.

```{r}
plot_bar(data,by='Gender',ncol=2)
```

In this section, we show the distribution of genders in four other categories, which is relatively balanced across all graphs. Hence, we can conclude that genders are not the deciding factor that we need to analyze further in the data analysis section, meaning that it is not important enough as a consideration point to improve the satisfaction rate.

```{r}
plot_bar(data,by='Customer.Type',ncol=2)
```

From the customer type distribution and association graphs, it can be noticed that the majority of first time passengers are flying economy class, and also more likely to have the less-favorable first imnpression towards their flying experience, which can be seen in its relation with satisfaction level.

```{r}
plot_bar(data,by='Type.of.Travel',ncol=2)
```

As we can see above, the majority of business travelers fly on the business class as well, and they are also more likely to be satisfied with their flying experience. This is consistent with our observation and discussion on the previous section. On the oppositem, travelers with personal reason, such as leisure, are more likely to fly on both of the economy classes and also less likely to be satisfied with their flying experience. 

```{r}
plot_bar(data,by='Class',ncol=2)
```

**Rencana hapus section ini karena dirasa ga nambah observasi apapun, TBD**

## Feature Engineering <a name="2.3"></a>

We noticed that the age distribution have high variation, therefore we try to create the age_group column to divide the age group into four categories: children, youth, adult, and senior. This categorization is based on most of the division range used in a lot of transportation services across Europe. The age group is defined and plotted in R as follows:

```{r}
data = data %>% mutate(Age_Range = if_else(Age <= 15,"Children",
if_else(16 <= Age & Age <= 25,"Youth",
if_else(26 < Age & Age <= 60,"Adult","Senior"))))
```

```{r}
plot_bar(data$Age_Range,ncol=2,order_bar=T,ggtheme = theme_minimal())
```

Now we can interpret from the age group that the largest segment of our customer is belong to adult age group. This is understandable since the adult group has the widest range of age compared to other age groups.

Another data we can group is the flight distance which currently right skewed. We will create new variables of flight distance by grouping them into three categories: short-haul, medium-haul, and long-haul. The division of distance is based on the limit defined by David W. Wragg in his book A Dictionary of Aviation:

Short-haul Flights: 0 - 900 miles (0 - 1,450 km)

Medium-haul Flights: 900 - 2,200 miles (1,450 - 3,540 km)

Long-haul Flights: 2,200 miles (3,540 km) and above

```{r}
data = data %>% mutate(Distance_Group = if_else(Flight.Distance < 900,"Short-haul",
if_else(900 <= Flight.Distance & Flight.Distance <= 2200,"Medium-haul","Long-haul")))
```

```{r}

plot_bar(data$Distance_Group, ncol = 2, order_bar = TRUE, ggtheme = theme_minimal())

```

We can divide which customer experiencing delay or not based on departure delay and arrival delay. United States' Federal Aviation Administration (FAA) defines a flight as delayed if it is 15 minutes or more behind schedule. We can use the following code to create the new variables to show the comparison of the numbers of flight with departure delay and arrival delay.

```{r}
data$departure.delay.status = ifelse(data$Departure.Delay > 15, "Delayed", "On Time")
data$arrival.delay.status = ifelse(data$Arrival.Delay > 15, "Delayed", "On Time")

plot_bar(data$departure.delay.status,ncol=2,order_bar=T,ggtheme = theme_minimal())
plot_bar(data$arrival.delay.status,ncol=2,order_bar=T,ggtheme = theme_minimal())
```

Because both departure and arrival delay status are equally important, we can combine them into one variable called **delay.status** with OR operator is used to display the total number of delayed flights.

```{r}
data$delay.status = ifelse(data$Departure.Delay > 15 | data$Arrival.Delay > 15, "Delayed", "On-time")

plot_bar(data$delay.status,ncol=2,order_bar=T,ggtheme = theme_minimal())
```

Next, We group the features into category of services that could be improved by the airline:

**Flight General Service:** On-board Service, Food and Drink, In-flight Service

**Flight Entertainment:** In Flight Wifi Service, In Flight Entertainment

**Pre-flight Service:** Ease of Online Booking, Check-in Service, Online Boarding

**Comfortability:** Seat Comfort, Leg Room Service, Cleanliness

```{r}
data$In.flight.service = rowSums(data[,c('On.board.Service','Food.and.Drink','In.flight.Service')],na.rm = TRUE)
data$Flight.Entertainment = rowSums(data[,c('In.flight.Wifi.Service','In.flight.Entertainment')],na.rm = TRUE)
data$Pre.flight.service = rowSums(data[,c('Ease.of.Online.Booking','Check.in.Service','Online.Boarding')],na.rm = TRUE)
data$Comfortability = rowSums(data[,c('Seat.Comfort','Leg.Room.Service','Cleanliness')],na.rm = TRUE)

plot_histogram(data[ , c("In.flight.service", "Flight.Entertainment", "Pre.flight.service", "Comfortability")], ncol=2,ggtheme = theme_minimal())
```

Combining several category of services into one variable is useful to see the overall satisfaction of the airline services in numerous area of improvement. For example, as we can see above that in general the passengers found that the flights they are taking are relatively comfortable. However, the pre-flight service and flight entertainment category received mixed reviews and can be considered as an improvement area for the airline, where further analysis could be done to see which of the element of those services are the most dissatisfying for the passengers.

**DARI FEATURE ENGINEERING KE SECTION SELANJUTNYA HARUS CROSSCHECK, BEBERAPA VARIABEL BARU BERUBAH RANGE DAN PENAMAANNYA**


## Data Tranformation <a name="2.4"></a>
Data transformation plays a key role to make sure all data is in the same scale and distribution. we will start  to take a look on our data distribution.

```{r}

library(ggplot2)
library(DataExplorer)

# Set default colors for histogram bars
update_geom_defaults("bar", list(fill = "steelblue", color = NA))

# Generate histogram with updated colors
plot_histogram(data, 
               ncol = 2, 
               ggtheme = theme_minimal() + theme(strip.background = element_blank(),
                                                 strip.text = element_text(color = "black")))


```
This part is to undertand the distribution of data before it is used. As we can see in the histogram, the data is not normally distributed. Therefore, we need to normalize the data.
There are several concerning variables in the dataset that are part of main focus in the data transformation process.
<ul>
<li>**arrival.delays** and **departure.delays** have highly-right skewed distribution where most values are concentrated to zero.</li>
<li>**flight.distance** has a right-skewed distribution concentrated between 500 and 1500, with a long tail up to 4000.</li>
<li>**age** has a right-skewed distribution concentrated between 20 and 50, with a long tail up to 80.But this variable is less concerning compared to the previous ones.</li>
</ul>
In the following step we will normalize the data by applying log transformation to the concerning variables.


```{r}
data$Departure.Delay.Duration = ifelse(data$Departure.Delay > 0, data$Departure.Delay, NA)
data$Arrival.Delay.Duration = ifelse(data$Arrival.Delay > 0, data$Arrival.Delay, NA)

data$Flight.Distance.log = log(1 + data$Flight.Distance)
data$Age.log = log(1 + data$Age)
data$Departure.Delay.Duration.log = log(1 + data$Departure.Delay.Duration)
data$Arrival.Delay.Duration.log = log(1 + data$Arrival.Delay.Duration)

plot_histogram(data[, c("Flight.Distance.log", "Age.log", "Departure.Delay.Duration.log", "Arrival.Delay.Duration.log")], ncol=2,ggtheme = theme_minimal())
```
Data transformation is performed with visualization task to see the distribution of the data after the transformation. This aims to normalize skewed distribution.
<ul>
  <li>**arrival.delays** and **departure.delays** are transformed into log scale to address the skewed issues.</li>
  <li>**flight.distance** and **age** are also transformed into log scale to address the skewed issues.</li>
</ul>
After log-transormation, normalize the distribution is then performed as follow.

```{r}
data$Flight.Distance.log.z = scale(data$Flight.Distance.log)
data$Age.log.z = scale(data$Age.log)
data$Departure.Delay.Duration.log.z = scale(data$Departure.Delay.Duration.log)
data$Arrival.Delay.Duration.log.z = scale(data$Arrival.Delay.Duration.log)

plot_histogram(data[, c("Flight.Distance.log.z", "Age.log.z", "Departure.Delay.Duration.log.z", "Arrival.Delay.Duration.log.z")], ncol=2,ggtheme = theme_minimal())
```

As we can see in the histogram, the data is now normalized with 0 as the center. This is important to ensure that the data is on the same scale and distribution. This helps the model learn the data better and make better predictions.

Here are the reasons why performing normalization is important before using the data:
<ol>
  <li><strong>Comparison Across Variables</strong><br>
      Normalization ensures the data is on the same scale. This helps in making the model comparable and supports easier further analysis.
  </li>
  <li><strong>Improved Model Performance</strong><br>
      Many algorithms perform better when input variables are standardized, as it prevents variables with larger ranges from dominating the analysis.
  </li>
  <li><strong>Normalization Beyond Log Transformation</strong><br>
      While log transformation reduces skewness and normalizes distributions, scaling ensures uniformity across variables, enabling fair use in statistical techniques.
  </li>
</ol>

## Initial Plotting <a name="2.5"></a>

Our target is the satisfaction rate of the airlines services, therefore we need to identify how each variable are correlated to the satisfaction. This is important to understand how each variable's behavior toward main objective of the analysis.
Following is the behavior of each variables towards satisfaction rate.

```{r}
plot_bar(data,by='Satisfaction',ncol=2)
```
According to the graphic above, we can see that:
<ul>
<li>**Gender**: Both male and female customers have a higher proportion of "Neutral or Dissatisfied" responses compared to "Satisfied" ones. This indicates there is a room of improvement to increase satisfied number</li>
<li>**Customer Type**: Returning customers exhibit a higher proportion of "Satisfied" responses than first-time customers, who seem mostly "Neutral or Dissatisfied". This might indicate that familiarity with the company positively influences satisfaction.</li>
<li> **Type of Travel**: Business travelers show a higher proportion of "Satisfied" responses compared to personal travelers.</li>
<li> **Class**: Business class has the highest proportion of "Satisfied" responses, whereas Economy and Economy Plus lean more towards "Neutral or Dissatisfied." This indicates higher satisfaction among premium customers. </li>
<li> **Age Range**: Older and middle-aged customers show higher satisfaction levels compared to youth and children, who lean towards dissatisfaction.</li>
<li> **Distance Group**:Longer trips seem to lead to higher satisfaction levels, which could indicate that services during these trips meet or exceed customer expectations. </li>
<li> **Delay Status**: the behavior of satisfaction between on-time and delayed status is not significantly different </li>
</ul>


```{r}
data_subset <- data %>%
  select(Satisfaction, In.flight.service, Flight.Entertainment, Pre.flight.service, Comfortability)


# Convert to long format
data_long <- pivot_longer(data_subset, -Satisfaction, names_to = "Variable", values_to = "Value")

# Create faceted histogram
ggplot(data_long, aes(x = Value, fill = Satisfaction)) +
  geom_histogram(position = "stack", alpha = 0.5, bins = 30) +
  facet_wrap(~ Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histograms of New Numeric Variables by Satisfaction",
       x = NULL, y = "Count") +
  theme(
    strip.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

Graphic above is telling the satisfaction distribution based on services category such as comfort, digital, entertainment, and flight services. We can see that the distribution of satisfaction is not significantly different between each category.

```{r}
data %>% group_by(Class, Satisfaction) %>% summarize(num=n()) %>% mutate(percentage=round(num*100/sum(num),2))
```
Based on the data above, **69.44%** of Business passengers showing satisfaction, while only *18.77%* of Economy passengers showing satisfaction and only **24.64%** of Economy Plus passengers are satisfied. This indicates that the airline services are more satisfying for business class passengers compared to economy class passengers. This data highlights the need for airlines to focus on enhancing the customer experience, particularly in Economy and Economy Plus, to achieve better satisfaction rates.


```{r}
data %>% group_by(Type.of.Travel, Satisfaction) %>%
summarize(num=n()) %>%
mutate(percentage=round(num*100/sum(num),2))
```

Personal type of travel passenger is having a third of airline total customer with the number of satisfied customer is only **10%** from it. This is much lower compared to the business type customers with **58.37%** satisfaction rate. Personal travel satisfaction levels indicate areas for improvement in service offerings or customer experience. Therefore it is also important customer segment to be improved trying to understand more satisfaction triggers from personal type of travelers.

```{r}
data %>% group_by(Customer.Type, Satisfaction) %>%
summarize(num=n()) %>%
mutate(percentage=round(num*100/sum(num),2))

```

**First-time Customers**: A majority, 76.03%, are neutral or dissatisfied, while only 23.97% report being satisfied.This could be a concern since it is indicating a risk from airline for not retaining first-time customers.<br>
<br>
**Returning Customers**: A majority, 58.37%, are satisfied, while 41.63% are neutral or dissatisfied. This indicates that returning customers are more satisfied with the airline services compared to first-time customers. This data highlights the need for airlines to focus on enhancing the customer experience, particularly for first-time customers, to achieve better satisfaction rates.


```{r}
data %>% filter(Customer.Type == 'First-time') %>% group_by(Class ,Satisfaction) %>%
summarize(num=n()) %>%
mutate(percentage=round(num*100/sum(num),2))

```
The table shows significant differences in first-timer passenger satisfaction across flight classes. Business Class shows the highest satisfaction, with nearly 40% satisfied, though more than half remain neutral or dissatisfied. Economy Class fares worse, with 85% of passengers neutral or dissatisfied, and Economy Plus performs the poorest, with 92% dissatisfaction. Enhancing services for Economy and Economy Plus could greatly improve overall customer satisfaction.<br>
<br>
In conclusion, mostly first-timer passengers feeling dissatisfied on each classes with notably higher in economy and economy plus class. This is a concern for the airline, as it indicates a need to improve services for first-time customers, to retain them and increase satisfaction rates.


```{r}
data %>% group_by(Distance_Group) %>%
summarize(num=n()) %>%
mutate(percentage=round(num*100/sum(num),2))
```
Previously in the barplot satisfaction, we can notice that  as the distance lower the rate of disatisfied customer is increasing. **Below 1000 distance is having the highest dissatisfaction rate**. From the data above, this condition could be a big concern since the majority of the airline customer is having journey below 1000 (more than 60%). This is a concern for the airline, as it indicates a need to improve services for short-distance travelers, to retain them and increase satisfaction rates.
<br>
Next we will try to analyze the service factors related to the customer satisfaction, starting with customer type :

```{r}

# Compute mean for each continuous column
filtered_data <- data %>% filter(Customer.Type == 'First-time') 
filtered_data <- subset(filtered_data, select = -c(ID, Flight.Distance, Age, Arrival.Delay, Departure.Delay, Arrival.Delay.Duration, Arrival.Delay.Duration.log,
                                                   Arrival.Delay.Duration.log.z, Departure.Delay.Duration, Departure.Delay.Duration.log, Departure.Delay.Duration.log.z,
                                                   Flight.Distance.log, Flight.Distance.log.z, Age.log, Age.log.z))

mean_values <- sapply(filtered_data, function(x) if(is.numeric(x)) mean(x, na.rm = TRUE) else NA)
mean_values <- na.omit(mean_values)  

mean_df <- data.frame(Variable = names(mean_values), Mean = mean_values)

# Remove NA values (non-numeric columns)
# Sort in descending order
mean_df <- mean_df[order(mean_df$Mean, decreasing = TRUE), ]

# Plot bar chart with highest value on top and number labels
ggplot(mean_df, aes(x = reorder(Variable, Mean), y = Mean)) +
  geom_bar(stat = "identity", fill = "#CFCFFF") +
  geom_text(aes(label = round(Mean, 2)), hjust = -0.2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Mean of Continuous Variables", x = "Variable", y = "Mean Value")
```

We can identify that from the first time customer, the services that dissapointing them most in **Departure and Arrival Time Convenience, Ease of Online Booking, and Wifi Service**.While **Comfort Service** having the highest satisfaction value. <br>
This data can guide strategic improvements to enhance the first-time customer experience and increase satisfaction rates by focusing the improvement on those concerning satisfaction factors with the low score.

```{r}

# Compute mean for each continuous column
filtered_data <- data %>% filter(Type.of.Travel == 'Business') 
filtered_data <- subset(filtered_data, select = -c(ID, Flight.Distance, Age, Arrival.Delay, Departure.Delay, Arrival.Delay.Duration, Arrival.Delay.Duration.log,
                                                   Arrival.Delay.Duration.log.z, Departure.Delay.Duration, Departure.Delay.Duration.log, Departure.Delay.Duration.log.z,
                                                   Flight.Distance.log, Flight.Distance.log.z, Age.log, Age.log.z))

mean_values <- sapply(filtered_data, function(x) if(is.numeric(x)) mean(x, na.rm = TRUE) else NA)
mean_values <- na.omit(mean_values)  

mean_df <- data.frame(Variable = names(mean_values), Mean = mean_values)

# Remove NA values (non-numeric columns)
# Sort in descending order
mean_df <- mean_df[order(mean_df$Mean, decreasing = TRUE), ]

# Plot bar chart with highest value on top and number labels
ggplot(mean_df, aes(x = reorder(Variable, Mean), y = Mean)) +
  geom_bar(stat = "identity", fill = "#008080") +
  geom_text(aes(label = round(Mean, 2)), hjust = -0.2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Mean of Continuous Variables", x = "Variable", y = "Mean Value")
```

We can identify that from the Personal type of travel customers, the services that dissapointing them most in **Departure and Arrival Time Convenience, In flight wifi service, Ease of Online Booking**.These areas could be prioritized for enhancement to improve overall satisfaction for business travelers. The top satisfaction factors is **Comfort service**.<br>
As you can see, personal type of travel customer satisfaction data is showing similar behaviour with the first-timer passengers. Thus, improving low-rated areas like WiFi availability and online booking ease may help elevate the overall customer experience for this segment.

```{r}

# Compute mean for each continuous column
filtered_data <- data %>% filter(Class == 'Economy') 
filtered_data <- subset(filtered_data, select = -c(ID, Flight.Distance, Age, Arrival.Delay, Departure.Delay, Arrival.Delay.Duration, Arrival.Delay.Duration.log,
                                                   Arrival.Delay.Duration.log.z, Departure.Delay.Duration, Departure.Delay.Duration.log, Departure.Delay.Duration.log.z,
                                                   Flight.Distance.log, Flight.Distance.log.z, Age.log, Age.log.z))

mean_values <- sapply(filtered_data, function(x) if(is.numeric(x)) mean(x, na.rm = TRUE) else NA)
mean_values <- na.omit(mean_values)  

mean_df <- data.frame(Variable = names(mean_values), Mean = mean_values)

# Remove NA values (non-numeric columns)
# Sort in descending order
mean_df <- mean_df[order(mean_df$Mean, decreasing = TRUE), ]

# Plot bar chart with highest value on top and number labels
ggplot(mean_df, aes(x = reorder(Variable, Mean), y = Mean)) +
  geom_bar(stat = "identity", fill = "#DC143C") +
  geom_text(aes(label = round(Mean, 2)), hjust = -0.2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Mean of Continuous Variables", x = "Variable", y = "Mean Value")
```

The graph above is satisfaction data from Economy class customers. The biggest contributors to low satisfaction rate are **ease of online booking, wifi service, and online boarding**. While **Comfort Service** have the highest satisfaction rate among the Economy class customers. This data can guide strategic improvements to enhance the Economy class customer experience and increase satisfaction rates by focusing the improvement on those concerning satisfaction factors with the low score.

### Summary of Initial Plotting
<ol>
<li>43% of total passengers have liked the airline service. The majority of customers who are satisfied are from business class</li>
<li>57% of total passengers are not satisfied. The majority of them are from Economy class </li>
<li>Only 18% of people have travelled for first time in our airline service. Out of those customers, nearly 76% of customers are not satisfied with our service which could create a chance in future of not returing of customers to our service again. When passengers are coming for first time, most of them have chosen the economy class </li>
<li>Out of the customers who opted for business class, nearly 69% of customers are satisfied with the business class. Out of the customers who opted for economy class, nearly 81% of them are not satisfied with it. Customers who opted for economy plus class,nearly 75% of them are not satisfied with it. </li>
<li>Whether people are coming for first time or not and also irrespective of their travel type, they are mostly not satisfied with the Economy and Economy Plus classes. There is strong need for the improvement of Economy class since 45% of total passengers are from economy class. Moreover, 60% of passengers travel less than 10k km and most of them prefer economy class.</li>
<li>Passengers are not so satisfied with online booking, Online Boarding and the Wifi service mostly especially those who take economy class.</li>
<li>82% of total passengers are returning to the airline service. Out of those 105773 passengers,50% of passengers are from busines class and 42% of passengers are from economy class. Customer who are returning to our service are aged above 30 and make business travel and travel less than 1000 km mostly </li>
<li> Departure and arrival time covenience is considered big contributors to the customers dissatisfaction especially for first-timer passengers and personal travel type customers</li>
<li> Passengers mostly take short distance travel (below 1000 km) and it contributes to the high number of dissatisfaction. </li>
</ol>

## Reflections <a name="2.6"></a>

Lorem Ipsum

# Data Modeling <a name="3"></a>

Lorem Ipsum

## Dimension Reduction <a name="3.1"></a>

PCA can be used to reduce the dimensionality of the dataset while ensuring that we dont lose too much information

**PCA with Numeric Variable Only**

```{r}
# Use the standardized data
data_standardized <- data %>%
  select(-c(ID, Arrival.Delay.Duration.log, Arrival.Delay.Duration.log.z,
            Departure.Delay.Duration.log, Departure.Delay.Duration.log.z, Flight.Distance.log,
            Flight.Distance.log.z,Departure.Delay.Duration, Arrival.Delay.Duration,
            Age.log, Age.log.z)) %>% 
  select(where(is.numeric)) %>%
  scale(center = TRUE, scale = TRUE)

results <- prcomp(data_standardized)
summary(results)
```

Cummulative value already achieved 90% using 12 Principal Components as below

```{r}
results$rotation[ , c(1:2) ]
```
To focus on variable with high loadings, we set the threshold of 0.2 and only select the first principal component.

```{r}
loadings <- data.frame(results$rotation)
threshold <- 0.20
indices <- abs(loadings$PC1) >= threshold
data.frame(variable = rownames(loadings)[indices], 
           loading = loadings$PC1[indices])
```

Lorem Ipsum

```{r}
loadings_df <- data.frame(
  variable = rownames(loadings)[indices],
  loading = loadings$PC1[indices]
)

# Plot
ggplot(loadings_df, aes(x = reorder(variable, -loading), y = loading, fill = loading > 0)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Top Loadings for PC1",
       x = "Variable",
       y = "Loading Value") +
  scale_fill_manual(values = c("steelblue", "tomato")) +
  theme_minimal()
```

Analyzing top contributor in PC1-PC12

```{r}
loadings <- as.data.frame(results$rotation)
loadings$Variable <- rownames(loadings)

# Top contributors for PC1–PC12
top_vars <- apply(abs(loadings[, 1:12]), 2, function(x) names(sort(x, decreasing = TRUE)[1:5]))
print(top_vars)
```
PC1 – In-Flight Amenities & Comfort
Driven by Flight.Entertainment, Comfortability, In.flight.Entertainment, In.flight.service, and Cleanliness. This component captures the overall in-flight experience focused on comfort and entertainment.

PC2 – Digital & Booking Experience
Influenced by Ease.of.Online.Booking, Pre.flight.service, and In.flight.Wifi.Service. It represents passengers’ interaction with digital services before and during the flight.

PC3 – Operational Onboard Service
Dominated by In.flight.Service, Baggage.Handling, and Seat.Comfort, this component reflects service reliability and seat-related comfort during the flight.

PC4 – Flight Timing & Boarding
Characterized by Arrival.Delay, Departure.Delay, and Online.Boarding. It relates to punctuality and boarding process efficiency.

PC5 – Passenger Profile & Journey
Shaped by Online.Boarding, Flight.Distance, Age, and Gate.Location, this component reflects demographic and journey-specific traits.

PC6 – Schedule & Gate Convenience
Led by Departure.and.Arrival.Time.Convenience, Gate.Location, and Age, this component captures how convenient flight times and gate accessibility are for passengers.

PC7 – Pre-Flight & Cabin Space
Defined by Check.in.Service, Leg.Room.Service, and Flight.Distance, combining service before boarding with cabin comfort.

PC8 – Age-Based Travel Patterns
Mainly driven by Age, Flight.Distance, and Check.in.Service, this component shows how age may influence travel experience and expectations.

PC9 – Comfort in Long Trips
Includes Leg.Room.Service, Flight.Distance, and Comfortability, highlighting comfort needs for longer or more frequent flights.

PC10 – In-Flight Consumables
Composed of On.board.Service, In.flight.service, and Food.and.Drink, focusing on passengers’ satisfaction with in-flight consumables.

PC11 – Delays & Terminal Logistics
Influenced by Arrival.Delay, Departure.Delay, and Gate.Location, this component represents disruptions tied to flight and gate logistics.

PC12 – Check-In & Time Coordination
Driven by Departure.and.Arrival.Time.Convenience and Check.in.Service, highlighting the efficiency of early-stage travel processes.

```{r}
screeplot(results, type = "lines")
```

Lorem Ipsum

**PCA with One Hot Encoding**

```{r}
library(caret)

# Use the standardized data
data_standardized <- data %>%
  select(-c(ID, Arrival.Delay.Duration.log, Arrival.Delay.Duration.log.z,
            Departure.Delay.Duration.log, Departure.Delay.Duration.log.z, Flight.Distance.log,
            Flight.Distance.log.z,Departure.Delay.Duration, Arrival.Delay.Duration,
            Age.log, Age.log.z))

dummies <- dummyVars(~ ., data = data_standardized)
data_encoded <- predict(dummies, newdata = data_standardized)

data_encoded_standardized <- scale(data_encoded, center = TRUE, scale = TRUE)

results <- prcomp(data_encoded_standardized)
summary(results)
```

When PCA was applied to numeric-only variables, the first 12 components explained over 90% of the variance, indicating strong inter-variable correlation and compact data structure.
However, after including one-hot encoded categorical variables, the number of components required to achieve the same level of variance increased to 20. This suggests that categorical variables contribute additional but more dispersed variance, requiring more dimensions to capture the overall structure.

## Classification Method <a name="3.2"></a>

Lorem Ipsum

### Model Preparation <a name="3.2.1"></a>

```{r}
# Create copy of dataset for the purpose of classification only, convert to factor
data_clsf <- data %>%
      mutate(across(-c(ID, Age, Flight.Distance, Departure.Delay, Arrival.Delay, 
                   Departure.Delay.Duration,
                   Arrival.Delay.Duration, Arrival.Delay.Duration.log, Arrival.Delay.Duration.log.z,
                   Departure.Delay.Duration.log, Departure.Delay.Duration.log.z, Flight.Distance.log,
                   Flight.Distance.log.z, Age.log, Age.log.z), as.factor))

# Encode Target Variable
data_clsf$Satisfaction <- ifelse(data_clsf$Satisfaction=="Satisfied",1,0)
data_clsf$Satisfaction <- factor(data_clsf$Satisfaction, levels = c(0, 1))

# For experiment, create subset of untransformed data, data with log, and data with normalization
data_clsf_ori <- data_clsf %>%
  select(-c(ID, Arrival.Delay.Duration.log, Arrival.Delay.Duration.log.z,
            Departure.Delay.Duration.log, Departure.Delay.Duration.log.z, Flight.Distance.log,
            Flight.Distance.log.z, Age.log, Age.log.z)) 

data_clsf_log <- data_clsf %>%
  select(-c(ID, Arrival.Delay.Duration.log.z, Departure.Delay.Duration.log.z, Flight.Distance.log.z,
            Departure.Delay.Duration, Arrival.Delay.Duration, Age.log.z, Arrival.Delay.Duration,
            Departure.Delay.Duration, Flight.Distance, Age)) 

data_clsf_norm <- data_clsf %>%
  select(-c(ID, Arrival.Delay.Duration.log,
            Departure.Delay.Duration.log, Flight.Distance.log,
            Age.log, Arrival.Delay.Duration,
            Departure.Delay.Duration, Flight.Distance, Age)) 
```

Lorem Ipsum

**Start with Untransformed Dataset**

**Split Dataset Training Testing**

```{r}
set.seed(46748717)

library (rsample)

proportion <-  0.7
split <- initial_split(data_clsf_ori, prop = proportion)
training <- training(split)
testing <- testing(split)
```

Lorem Ipsum

### Training a decision tree model on the data <a name="3.2.2"></a>

```{r}
model <- C50::C5.0(Satisfaction ~., 
                   data = training)
summary(model)
```

Lorem Ipsum

```{r}
print("Confusion matrix based on testing data")
pred.test <- predict(model, testing)
gmodels::CrossTable(testing$Satisfaction, pred.test,
                    prop.chisq = FALSE,
                    prop.c = FALSE,
                    prop.r = FALSE,
                    prop.t = FALSE,
                    dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```



```{r}
# Calculating Accuracy

accuracy = (21498 + 15676) / 38964
print(accuracy)
```

Accuracy already high with 95.4%

**Try with dataset that already log transformed**

```{r}
set.seed(46748717)

library (rsample)

proportion <-  0.7
split <- initial_split(data_clsf_log, prop = proportion)
training <- training(split)
testing <- testing(split)

model <- C50::C5.0(Satisfaction ~., 
                   data = training)
summary(model)

print("Confusion matrix based on testing data")
pred.test <- predict(model, testing)
gmodels::CrossTable(testing$Satisfaction, pred.test,
                    prop.chisq = FALSE,
                    prop.c = FALSE,
                    prop.r = FALSE,
                    prop.t = FALSE,
                    dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

The result is almost identical since the algorithm determine the transformed data is not have significant importance. Therefore the improvement will focus on tuning the parameter of the model.

### Model Improvement <a name="3.3.3"></a>

**Boosting**

Lorem Ipsum


```{r}
library(C50)
library(gmodels)

set.seed(46748717)

proportion <-  0.7
split <- initial_split(data_clsf_ori, prop = proportion)
training <- training(split)
testing <- testing(split)

model_boost <- C5.0(Satisfaction ~.,
                    data = training,
                    trials = 10)

# Predicting on the testing data
print("Confusion matrix based on testing data (boosting)")
pred.test <- predict(model_boost, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```


```{r}
# Calculating Accuracy with Booster

accuracy = (21229 + 15816) / 38964
print(accuracy)
```

Accuracy didnt increase significant

Lorem Ipsum

**Assigning Cost to Mistake**

More costly to predict dissatisfied customer satisfied, cost higher in False Positive

```{r}
# Specifying the cost matrix
cost.matrix <- matrix(c(NA, 1,  # FN costs of predicting "Disatisfied" whereas actual value is "Satisfied"
                        2, NA), # FP costs of predicting "Satisfied" whereas actual value is "Disatisfeid"
                      nrow = 2, 
                      ncol = 2,
                      byrow = FALSE)
rownames(cost.matrix) <- colnames(cost.matrix) <- c(1, 0)

# Estimating the model with the cost matrix
model.cost <- C5.0(Satisfaction ~., 
              data = training,
              costs = cost.matrix)

print("Confusion matrix based on testing data (costs")
pred.test <- predict(model.cost, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r}
# Calculating Accuracy with Booster

accuracy = (21755  + 15087 ) / 38964
print(accuracy)
```

Accuracy decrease slightly

```{r}
# Calculating Decrease in False Positive

decrease_fp = (495   - 238  ) / 495
print(decrease_fp)
```

False positive decrease by 51.9%, from 495 to 238

**Random Forest**

```{r random forest}
data_randfor <- data_clsf_ori %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration, Flight.Distance, Age)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix based on testing data (costs")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r}
# Calculating Accuracy with Random Forest

accuracy = (21410   + 15793  ) / 38964
print(accuracy)
```

Accuracy increase 95.4%

**Using Ranger to implement random forest to the database with high cardinality**

```{r}
# install.packages("ranger")
library(ranger)
```

```{r}
proportion <-  0.7
split <- initial_split(data_clsf_ori, prop = proportion)
training <- training(split)
testing <- testing(split)

model.ranger <- ranger(Satisfaction ~., 
                       data = training,
                       num.trees = 500, # how many trees should be grown?
                       mtry = 2, # how many variables to sample at each split?
                       replace = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix based on testing data (costs")
pred.test <- predict(model.ranger, testing)$predictions
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r}
# Calculating Accuracy with Ranger

accuracy = (21412   + 15739  ) / 38964
print(accuracy)
```

Accuracy didnt increase significant

### Variable Importance <a name="3.4"></a>

```{r}
library(randomForest)

importance <- importance(model.forest)
print(importance)
```

Plot the importance

```{r varimp-plot, fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum

High satisfaction on :
- Type of travel : Business
- Class : Business
- Customer Type : Returning

Type of Travel : Business

```{r fig.width=10, fig.height=8}
data_randfor <- data_clsf_ori[ which(data_clsf_ori$Type.of.Travel == "Business"), ]
data_randfor <- data_randfor %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration,
                                           Flight.Distance, Age, Type.of.Travel)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix for Random Forest Type of Travel Business")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))

```

```{r fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum

Class : Business

```{r}
data_randfor <- data_clsf_ori[ which(data_clsf_ori$Class == "Business"), ]
data_randfor <- data_randfor %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration,
                                           Flight.Distance, Age, Class)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix for Random Forest Class Business")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum

Customer Type : Returning

```{r fig.width=10, fig.height=8}
data_randfor <- data_clsf_ori[ which(data_clsf_ori$Customer.Type == "Returning"), ]
data_randfor <- data_randfor %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration,
                                           Flight.Distance, Age, Customer.Type)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix for Random Forest Customer Type Returning")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum

Low Satisfaction on :
- Type of Travel Personal
- Class Economy and Economy Plus
- Customer Type First Time

Type of travel personal

```{r}
data_randfor <- data_clsf_ori[ which(data_clsf_ori$Type.of.Travel == "Personal"), ]
data_randfor <- data_randfor %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration,
                                           Flight.Distance, Age, Type.of.Travel)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix for Random Forest Type of Travel Personal")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum

Class Economy and Economy Plus

```{r}
data_randfor <- data_clsf_ori[ which(data_clsf_ori$Class %in% c("Economy", "Economy Plus")), ]
data_randfor <- data_randfor %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration,
                                           Flight.Distance, Age, Class)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix for Random Forest Type of Class Economy and Economy Plus")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum


Customer Type First Time

```{r}
data_randfor <- data_clsf_ori[ which(data_clsf_ori$Customer.Type %in% "First-time"), ]
data_randfor <- data_randfor %>% select(-c(Arrival.Delay.Duration, Departure.Delay.Duration,
                                           Flight.Distance, Age, Customer.Type)) 

proportion <-  0.7
split <- initial_split(data_randfor, prop = proportion)
training <- training(split)
testing <- testing(split)

model.forest <- randomForest::randomForest(Satisfaction ~., 
                                           data = training,
                                           ntree = 500, # how many trees should be grown?
                                           mtry = 2, # how many variables to sample at each split?
                                           replace = TRUE,
                                           importance = TRUE) # sampling of cases with or without replacement?

print("Confusion matrix for Random Forest Type of Customer Type First Time")
pred.test <- predict(model.forest, testing)
CrossTable(testing$Satisfaction, pred.test,
           prop.chisq = FALSE,
           prop.c = FALSE,
           prop.r = FALSE,
           prop.t = FALSE,
           dnn = c("Actual Satisfaction", "Predicted Satisfaction"))
```

```{r fig.width=10, fig.height=8}
varImpPlot(model.forest)
```

Lorem Ipsum

## Logistic Regression <a name="3.3"></a>

Why Logistic Regression?

### Model Preparation <a name="3.3.1"></a>

```{r}
# Split training and testing data

set.seed(46748756)

library (rsample)

# Create copy of dataset for the purpose of classification only, convert to factor
data_logreg <- data %>%
  mutate(across(-c(ID, Age, Flight.Distance, Departure.Delay, Arrival.Delay, 
                   Departure.Delay.Duration,
                   Arrival.Delay.Duration, Arrival.Delay.Duration.log, Arrival.Delay.Duration.log.z,
                   Departure.Delay.Duration.log, Departure.Delay.Duration.log.z, Flight.Distance.log,
                   Flight.Distance.log.z, Age.log, Age.log.z), as.factor)) %>% subset(
                     select = -c(ID, Departure.Delay.Duration,
                   Arrival.Delay.Duration, Arrival.Delay.Duration.log, Arrival.Delay.Duration.log.z,
                   Departure.Delay.Duration.log, Departure.Delay.Duration.log.z)
                     )

# Cleaning column from zero score that only exist in small quantity (most of them only have 1 data, cant be splitted to training and testing)
cols_to_clean <- c("On.board.Service", "Check.in.Service", "Seat.Comfort",
                   "In.flight.Service", "Gate.Location", "Cleanliness", 
                   "In.flight.Entertainment")

for (col in cols_to_clean) {
  data_logreg <- subset(data_logreg, data_logreg[[col]] != "0")
  data_logreg[[col]] <- droplevels(data_logreg[[col]])
}

proportion <-  0.7
split <- initial_split(data_logreg, prop = proportion)
training <- training(split)
testing <- testing(split)
```

Lorem Ipsum

### Training Logistic Regression Model <a name="3.3.2"></a>

```{r}
# Using all data
model_log <- glm(Satisfaction ~., 
               data = training, family = "binomial")

summary(model_log)
```

Lorem Ipsum

### Interpretation of the Model <a name="3.3.3"></a>

Lorem Ipsum

**Interpret the coefficient**

```{r}
exp(coef(model_log))
```

Lorem Ipsum

**Visualize the coefficient**

```{r fig.width=10, fig.height=20}
coefs <- summary(model_log)$coefficients
coef_df <- data.frame(
  Variable = rownames(coefs),
  Estimate = coefs[, "Estimate"],
  StdError = coefs[, "Std. Error"],
  p_value = coefs[, "Pr(>|z|)"]
)

# Remove intercept for clarity
coef_df <- coef_df[coef_df$Variable != "(Intercept)", ]

# Plot using ggplot2
library(ggplot2)

ggplot(coef_df, aes(x = reorder(Variable, Estimate), y = Estimate)) +
  geom_point(color = "darkblue") +
  geom_errorbar(aes(ymin = Estimate - 1.96 * StdError,
                    ymax = Estimate + 1.96 * StdError), width = 0.2) +
  coord_flip() +
  labs(title = "Logistic Regression Coefficients",
       x = "Predictor",
       y = "Coefficient Estimate (log-odds)") +
  theme_minimal()
```

Lorem Ipsum

**Interpreting Z Value**

```{r}
model_summary <- summary(model_log)

# Extract z-values and convert to data frame
z_df <- data.frame(
  Variable = rownames(model_summary$coefficients),
  Z_value = model_summary$coefficients[, "z value"]
)

# Remove intercept
z_df <- subset(z_df, Variable != "(Intercept)")

z_df
```

```{r  fig.width=10, fig.height=20}
# Plot using ggplot2
library(ggplot2)

ggplot(z_df, aes(x = reorder(Variable, abs(Z_value)), y = Z_value)) +
  geom_col(fill = "steelblue") +
  geom_hline(yintercept = c(-1.96, 1.96), linetype = "dashed", color = "red") + # 95% significance threshold
  coord_flip() +
  labs(title = "Z-values from Logistic Regression",
       x = "Predictor Variable",
       y = "Z-value (Wald Statistic)") +
  theme_minimal()
```

Lorem Ipsum

### Model Evaluation <a name="3.3.4"></a>

```{r}
pred.test <- predict(model_log, newdata = testing, type = "response")

# Convert to class labels
pred.test.result <- ifelse(pred.test > 0.5, "Satisfied", "Neutral or Dissatisfied")
testing$Satisfaction <- factor(testing$Satisfaction, levels = c("Satisfied", "Neutral or Dissatisfied"))
pred.test.result <- factor(pred.test.result, levels = c("Satisfied", "Neutral or Dissatisfied"))

confusionMatrix(pred.test.result, testing$Satisfaction)
```

Accuracy 93.7% with sensitivity 95.2% and specificy 91.9%

**Interpret ROC and AUC**

```{r}
library(pROC)

# ROC curve and AUC
roc_obj <- roc(testing$Satisfaction, pred.test)
plot(roc_obj, col = "blue", main = "ROC Curve")
auc(roc_obj)
```

Lorem Ipsum

```{r}
auc(roc_obj)
```

Lorem Ipsum

```{r}
plot(model_log)
```

Lorem Ipsum

### Improving Model Performance

**Using significant variables only**

p-value < 0.05

```{r}
training_signif <- training %>% subset(select = -c(Departure.Delay, Arrival.Delay, Flight.Distance, 
                                                  In.flight.Wifi.Service, Food.and.Drink, 
                                                  In.flight.Entertainment, Age_Range, Distance_Group,
                                                  In.flight.service, Flight.Entertainment, 
                                                  Comfortability, Pre.flight.service, 
                                                  Flight.Distance.log.z, Age.log.z))

model_log_signif <- glm(Satisfaction ~., 
               data = training_signif, family = "binomial")

summary(model_log_signif)

```

AIC increase to 44749


```{r}
pred.test <- predict(model_log_signif, newdata = testing, type = "response")

# Convert to class labels
pred.test.result <- ifelse(pred.test > 0.5, "Satisfied", "Neutral or Dissatisfied")
testing$Satisfaction <- factor(testing$Satisfaction, levels = c("Satisfied", "Neutral or Dissatisfied"))
pred.test.result <- factor(pred.test.result, levels = c("Satisfied", "Neutral or Dissatisfied"))

confusionMatrix(pred.test.result, testing$Satisfaction)
```

The accuracy decrease

ANOVA test :

```{r}
anova(model_log, model_log_signif, test="Chisq")
```

Model full siginificantly better than model with significant only

**Adjusting Threshold**

```{r}
coords(roc_obj, "best", ret = "threshold")
```

```{r}
pred.test <- predict(model_log, newdata = testing, type = "response")

# Convert to class labels
pred.test.result <- ifelse(pred.test > 0.5012364, "Satisfied", "Neutral or Dissatisfied")
testing$Satisfaction <- factor(testing$Satisfaction, levels = c("Satisfied", "Neutral or Dissatisfied"))
pred.test.result <- factor(pred.test.result, levels = c("Satisfied", "Neutral or Dissatisfied"))

confusionMatrix(pred.test.result, testing$Satisfaction)
```


Performance not increase significantly

**Dimensionality Reduction**

```{r}
training_pca <- training %>%
  mutate(across(everything(), ~ if (all(!is.na(as.numeric(as.character(.x))))) 
    as.numeric(as.character(.x)) else .x)) %>%
  select(where(is.numeric)) %>%
  scale(center = TRUE, scale = TRUE)

pca_results <- prcomp(training_pca)
summary(pca_results)
```

12 var already achieve 91%

```{r}
pca_data <- as.data.frame(pca_results$x[, 1:12])
pca_data$Satisfaction <- training$Satisfaction

model_log_pca <- glm(Satisfaction ~., 
               data = pca_data, family = "binomial")

summary(model_log_pca)
```

AIC higher 80736

```{r}
# 1. Convert test data to numeric and scale
test_pca_scaled <- testing %>%
  mutate(across(everything(), ~ if (all(!is.na(as.numeric(as.character(.x))))) 
    as.numeric(as.character(.x)) else .x)) %>%
  select(where(is.numeric)) %>%
  scale(center = attr(training_pca, "scaled:center"), 
        scale = attr(training_pca, "scaled:scale"))  # Use training scale

# 2. Apply PCA transformation
test_pca <- as.data.frame(predict(pca_results, newdata = test_pca_scaled)[, 1:12])

# 3. Add target variable
test_pca$Satisfaction <- testing$Satisfaction

# 4. Predict using the model trained on PCA components
pred.test <- predict(model_log_pca, newdata = test_pca, type = "response")

# Convert to class labels
pred.test.result <- ifelse(pred.test > 0.5, "Satisfied", "Neutral or Dissatisfied")
testing$Satisfaction <- factor(testing$Satisfaction, levels = c("Satisfied", "Neutral or Dissatisfied"))
pred.test.result <- factor(pred.test.result, levels = c("Satisfied", "Neutral or Dissatisfied"))

confusionMatrix(pred.test.result, testing$Satisfaction)
```

Accuracy decrease using PCA

# Interpretation <a name="4"></a>

Lorem Ipsum

## Result Visualization <a name="4.1"></a>

Lorem Ipsum

## Recommendation <a name="4.2"></a>

Lorem Ipsum

## Further Improvement for Better Recommendation <a name="4.3"></a>

Lorem Ipsum

## Conclusion & Limitations <a name="4.4"></a>

Lorem Ipsum

## References <a name=""></a>

Lorem Ipsum